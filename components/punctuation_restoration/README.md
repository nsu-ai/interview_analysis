# Module template

Модуль предназначен для восстановления пунктуации и заглавных букв в тексте.

## Структура

    .
    ├── data                        # Данные (примеры, необходимые маленькие файлы, инструкции по датасетам)
    │   │
    │   ├── input_example.json      # Пример входных данных
    │   └── output_example.json     # Пример выходных данных
    │
    ├── models                      # Реализации конкретных моделей
    │   │ 
    │   └── BertPunctRestorer       # Наша основная модель для восстановления пунктуации
    │       │
    │       ├── model               # Детали реализации, служебные классы
    │       ├── checkpoints         # Директория для подгрузки сохраненной модели по умолчанию
    │       ├── data                # Данные для обучения и валидации моделей
    │       ├── scripts             # Скрипты для подготовки данных, обучения и валидации
    │       └── README.md           # Подробное описание модели
    │ 
    ├── service.py                  # Flask-app, предоставляющий сервис для вызова моделей по API
    ├── Dockerfile                  # Dockerfile для запуска модуля как сервиса
    ├── requirements.txt            # Локальные зависимости модуля
    └── README.md (вы здесь)        # Описание модуля

## Сборка и запуск сервиса
Предобученные модели можно скачать по ссылке https://disk.yandex.ru/d/vglz9sJgd-utWQ и переместить в соответствующие папки:

* BertPunctResoter/checkpoint-2000 --> ./models/BertPunctRestorer/checkpoints/checkpoint-2000

Если во время создания Docker-образа не будут обнаружены файлы с моделями, они будут загружены автоматически.
Также может быть применена оптимизация с установкой PyTorch - можно заранее скачать его по ссылке https://disk.yandex.ru/d/j8FuKiGS0S0vRw и разместить в директории ./models

Собираем докер-образ с сервисом:
```commandline
docker build -t punctuation_restoration:0.1 .
```
Запускаем контейнер фоновым процессом:
```commandline
docker run -d -p 8803:8803 --name punctuation_restoration punctuation_restoration:0.1
```

## Вызов сервиса

Для использования модуля как отдельного сервиса нужно отправлять
json файл на endpoint "/recognize" с помощью POST-запроса. Например, 
это можно сделать с помощью библиотеки requests и скрипта на python:

```python
import requests
import json

filename = "./data/input_example.json"
input_json = json.loads(open(filename, encoding="utf-8").read())
resp = requests.post('http://localhost:8803/recognize', 
                     data=json.dumps(input_json), 
                     headers={'Content-type': 'application/json', 'Accept': 'text/plain'})
```

#### Входные данные: объект json

Входной JSON должен обязательно включать элемент "diarization", который содержит список слов, разделенных по дикторам:

```
{
    "diarization": [
      ...   
    ],
}
```

Пример входных данных:

```data/input_example.json```

#### Выходные данные: объект json

Добавляет элемент "text", содержащий собранный из "diarization" текст диалога с восстановленной пунктуацией, в исходный JSON

```
{
    "diarization": [
      ...   
    ],
    "text": "Текст с пунктуацией.",
}
```

Пример выходных данных:

```data/output_example.json```

## Модели

#### Поддерживаемые модели

* **BertPunctRestorer** - наша модель для восстановления пунктуации русских новостных текстов

#### Обучение моделей

Ссылки на скрипты для подготовки данных, обучения и тестирования моделей расположены в директориях scripts соответствующих моделей

#### Результаты тестирования

Тестировали на датасете из 100 текстов (уточню позже) из корпуса Lenta.Ru

Считали метрику F1-score по каждому классу

| Метрика       | BertPunctRestorer |
|---------------|:-----------------:|
| "O," F1-score |      0.9075       |
| "O." F1-score |      0.9108       |
| "OO" F1-score |      0.9828       |
| "U," F1-score |      0.8801       |
| "U." F1-score |      0.9105       |
| "UO" F1-score |      0.9337       |
